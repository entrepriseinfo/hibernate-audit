#!/bin/bash
#
# Convenience script to individually run (and debug) tests
#
# Usage:
#
# To run the tests: ./runtest
#
# To run the tests in debug mode: ./runtest -debug
#
# @Author: Ovidiu Feodorov <ovidiu@feodorov.com>
#

reldir=`dirname $0`

if [ -z "$TARGET_CLASS" -a -f $reldir/.testrc ]; then
   . $reldir/.testrc
fi

DEBUG_OPTS_SOCKET="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=12348"
DEBUG_OPTS_SHMEM="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_shmem,server=y,suspend=y,address=mvn2"

os=unix
cygwin=false;
case "`uname`" in
    CYGWIN*)
        cygwin=true
        os=windows
        ;;
esac

if [ $cygwin = true ]; then
    SEP=";"
else
    SEP=":"
fi

while [ "$1" != "" ]; do
    if [ "$1" = "-debug" ]; then
        if [ $cygwin = false ]; then
            DEBUG_OPTS="$DEBUG_OPTS_SOCKET"
        else
            DEBUG_OPTS="$DEBUG_OPTS_SHMEM"
        fi
        shift
        continue;
    else
        echo "Error, unknown switch: $1"
        exit 1
    fi
done

if [ "$TARGET_CLASS" != "" ]; then
    SINGLE_TEST="-Dtest=$TARGET_CLASS"
fi

echo "(cd ..; mvn -Dmaven.surefire.debug="$DEBUG_OPTS" $SINGLE_TEST clean test)"
(cd ..; mvn -Dmaven.surefire.debug="$DEBUG_OPTS" $SINGLE_TEST clean test)

#
# running from jar
#CP="\
#C:/Documents and Settings/ofeodoro/.m2/repository/org/testng/testng/5.7/testng-5.7-jdk15.jar;\
#../com.googlecode.hibernate.audit/target/com.googlecode.hibernate.audit-1.0.0-SNAPSHOT.jar;\
#../tmp/test-classes;\
#C:\Documents and Settings\ofeodoro\.m2\repository\log4j\log4j\1.2.14\log4j-1.2.14.jar"
#
#java -ea $DEBUG_OPTS -cp "$CP" org.testng.TestNG testng.xml
#



